<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}Tienda Online{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}" />
  </head>
  <body>
    <header>
      <div class="container">
        <div class="bar">
          <h1>Tienda Online</h1>

          <!-- Mobile toggle button -->
          <button class="nav-toggle" aria-expanded="false" aria-label="Abrir menú" type="button">☰</button>

          <!-- Nav container: stays visible on desktop, collapsible on mobile -->
          <div class="nav-container" id="main-nav">
            <nav>
              {% if session.get('username') %}
                <span class="nav-user">Sesión: {{ session.get('display_name') }}</span>
                {% if session.get('username') == 'admin' %}
                  <a class="button ghost" href="{{ url_for('sales_list') }}">Ventas</a>
                  <a class="button ghost" href="{{ url_for('products_list') }}">Inventario</a>
                {% else %}
                  <a class="button ghost" href="{{ url_for('products_list') }}">Tienda</a>
                  <a class="button ghost" href="{{ url_for('cart_view') }}">Carrito</a>
                {% endif %}
                <form class="inline" method="get" action="{{ url_for('logout') }}">
                  <button class="button small" type="submit">Salir</button>
                </form>
              {% endif %}
            </nav>
          </div>
        </div>
      </div>
    </header>
    <main>
      <div class="container">
      {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
      <ul class="flash-messages">
        {% for category, message in messages %}
        <li class="{{ category }}">{{ message }}</li>
        {% endfor %}
      </ul>
      {% endif %}
      {% endwith %}

      {% block content %}{% endblock %}
      </div>
    </main>

    <footer>
      <div class="container">
        <p>© {{ 2025 }} Tienda Online</p>
      </div>
    </footer>

    <script>
      // Simple mobile nav toggle
      (function(){
        const toggle = document.querySelector('.nav-toggle');
        const nav = document.getElementById('main-nav');
        if(!toggle || !nav) return;
        toggle.addEventListener('click', function(){
          const expanded = toggle.getAttribute('aria-expanded') === 'true';
          toggle.setAttribute('aria-expanded', String(!expanded));
          nav.classList.toggle('open');
        });

        // Close nav when clicking outside on mobile
        document.addEventListener('click', function(e){
          if(!nav.classList.contains('open')) return;
          if(e.target === toggle) return;
          if(nav.contains(e.target)) return;
          nav.classList.remove('open');
          toggle.setAttribute('aria-expanded', 'false');
        });
      })();
    </script>
  </body>
</html>

