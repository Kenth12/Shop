{% extends "base.html" %}

{% block title %}{{ action }} producto{% endblock %}

{% block content %}
<section class="card">
  <h2>{{ action }} producto</h2>
  <form method="post" class="form-grid">
    <label for="name">Nombre</label>
    <input type="text" id="name" name="name" value="{{ product.name if product else '' }}" required />

    <label for="sku">SKU</label>
    <input type="text" id="sku" name="sku" value="{{ product.sku if product else '' }}" />

    <label for="price">Precio</label>
    <input type="number" step="0.01" min="0" id="price" name="price" value="{{ product.price if product else '' }}" required />

    <label for="stock">Stock</label>
    <input type="number" min="0" id="stock" name="stock" value="{{ product.stock if product else 0 }}" required />

    <label for="image_file">Imagen (opcional)</label>
    <input type="file" id="image_file" accept="image/*" />
    <input type="hidden" id="image_base64" name="image_base64" value="{{ product.image_base64 if product and product.image_base64 else '' }}" />

    {% if product and product.image_base64 %}
    <div>
      <img src="{{ product.image_base64 }}" alt="{{ product.name }}" style="max-width:120px;border-radius:8px;border:1px solid #eee;margin-top:0.25rem" />
    </div>
    {% endif %}

    <div class="actions full">
      <a class="button ghost" href="{{ url_for('products_list') }}">Cancelar</a>
      <button class="button primary" type="submit">{{ action }}</button>
    </div>
  </form>
</section>
<script>
  // convert selected file to base64 and store in hidden input
  (function(){
    const fileInput = document.getElementById('image_file');
    const hidden = document.getElementById('image_base64');
    if(!fileInput || !hidden) return;
    fileInput.addEventListener('change', function(e){
      const f = fileInput.files && fileInput.files[0];
      if(!f) return;
      const reader = new FileReader();
      reader.onload = function(ev){
        hidden.value = ev.target.result;
      };
      reader.readAsDataURL(f);
    });
  })();
</script>
{% endblock %}
