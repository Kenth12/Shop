{% extends "base.html" %}

{% block title %}Inventario{% endblock %}

{% block content %}
<section class="card">
  <div class="header-row">
    {% if session.get('username') == 'admin' %}
      <h2>Inventario</h2>
      <div>
        <a class="button primary" href="{{ url_for('product_create') }}">Nuevo producto</a>
        <a class="button ghost" href="{{ url_for('sales_list') }}">Volver a ventas</a>
      </div>
    {% else %}
      <h2>Tienda</h2>
      <div>
        <a class="button ghost" href="{{ url_for('cart_view') }}">Ver carrito</a>
      </div>
    {% endif %}
  </div>

  {% if products %}
    {% if session.get('username') == 'admin' %}
      <div class="table-responsive">
      <table>
        <thead>
          <tr>
            <th>Nombre</th>
            <th>SKU</th>
            <th>Precio</th>
            <th>Stock</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for p in products %}
          <tr>
            <td>
              {% if p.image_base64 %}
              <div style="display:flex;gap:0.5rem;align-items:center">
                <img src="{{ p.image_base64 }}" alt="{{ p.name }}" style="width:48px;height:48px;object-fit:cover;border-radius:6px;border:1px solid #eee" />
                <div>{{ p.name }}</div>
              </div>
              {% else %}
                {{ p.name }}
              {% endif %}
            </td>
            <td>{{ p.sku or '-' }}</td>
            <td>${{ "%.2f"|format(p.price) }}</td>
            <td>{{ p.stock }}</td>
            <td>
              <a class="button small" href="{{ url_for('product_edit', product_id=p.id) }}">Editar</a>
              <form method="post" action="{{ url_for('product_delete', product_id=p.id) }}" style="display:inline;" onsubmit="return confirm('¿Eliminar este producto?');">
                <button class="button danger small" type="submit">Eliminar</button>
              </form>
              <form method="post" action="{{ url_for('cart_add') }}" style="display:inline;margin-left:0.5rem">
                <input type="hidden" name="product_id" value="{{ p.id }}" />
                <input type="number" name="quantity" value="1" min="1" style="width:64px;padding:0.35rem;border-radius:6px;border:1px solid #e6eef6;margin-right:0.25rem" />
                <button class="button primary small" type="submit">Añadir</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      </div>
    {% else %}
      <!-- Buyer view: product cards -->
      <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:1rem">
        {% for p in products %}
        <article class="card">
          {% if p.image_base64 %}
            <img src="{{ p.image_base64 }}" alt="{{ p.name }}" style="width:100%;height:140px;object-fit:cover;border-radius:8px;margin-bottom:0.5rem" />
          {% endif %}
          <h3 style="margin:0 0 0.25rem 0">{{ p.name }}</h3>
          <div class="muted">SKU: {{ p.sku or '-' }}</div>
          <div style="font-weight:800;margin:0.5rem 0">${{ "%.2f"|format(p.price) }}</div>
          <div class="muted small">{{ p.stock }} disponibles</div>
          <form method="post" action="{{ url_for('cart_add') }}" style="margin-top:0.5rem;display:flex;gap:0.5rem;align-items:center">
            <input type="hidden" name="product_id" value="{{ p.id }}" />
            <input type="number" name="quantity" value="1" min="1" style="width:72px;padding:0.45rem;border-radius:6px;border:1px solid #e6eef6" />
            <button class="button primary" type="submit">Añadir</button>
          </form>
        </article>
        {% endfor %}
      </div>
    {% endif %}
  {% else %}
    <p>No hay productos en el inventario.</p>
  {% endif %}
</section>
{% endblock %}
